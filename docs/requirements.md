# 献立提案アプリ要件定義

react native expo を利用し、献立提案アプリを作成する

## 1\. 全体機能一覧

| No. | 提供する機能                              | 詳細                                                                                                                                                           | 備考                                           |
| :-- | :---------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------- |
| 1   | アカウント設定                            | ユーザーのアカウントを作成する。e-mail, password の設定をする。                                                                                                | MVP 機能                                       |
| 2   | プロファイル詳細設定                      | 家族構成、アレルギー、健康志向、料理スキル、お惣菜の活用度などを設定。パーソナライズの基礎となる。                                                             | MVP 機能                                       |
| 3   | “今週まるごと”おまかせ献立提案            | プロファイルや在庫、1 週間分の献立(主菜、副菜、汁物)をバランス良く自動作成する。手作りだけでなく、市販のお惣菜や冷凍食品を組み合わせた現実的な献立を提案する。 | コア機能。献立作成のストレスを最も軽減する。   |
| 4   | 栄養・費用・手間の「三ツ星スコア」表示    | 提案された献立の「栄養バランス」「概算費用」「調理手間」を直感的に評価・表示する。                                                                             | ユーザーの意思決定を強力にサポートする。       |
| 5   | “ムダなし”買い物リスト自動生成            | 決定した献立に必要な食材から、冷蔵庫の在庫を差し引いた買い物リストを自動で作成。家族との共有も可能。                                                           | 買い物の手間と食品ロスを削減する。             |
| 6   | 作った料理の記録(料理ログ)                | 作った料理を写真で記録・カレンダー表示し、食生活を振り返ることができる。                                                                                       | 達成感を提供し、継続利用を促進する。           |
| 7   | 冷蔵庫スキャン機能(AI 画像認識)           | スマホカメラで冷蔵庫内を撮影し、食材を自動で認識・在庫リスト化する。                                                                                           | 開発フェーズ 2。手入力の手間を劇的に改善。     |
| 8   | お気に入りスーパー登録&チラシ情報自動取得 | 登録したスーパーの特売情報を自動で取得し、献立提案に反映させる。                                                                                               | 開発フェーズ 2。「節約」の価値を強化する。     |
| 9   | 今日の気分で検索・提案                    | 「中華」「さっぱり」などのキーワードや、使いたい食材名で献立を検索できる。                                                                                     | 開発フェーズ 2。提案の自由度を高める。         |
| 10  | “段取りアシスト”調理モード                | 複数の料理を並行して作る際の最適な手順をナビゲートする。                                                                                                       | 開発フェーズ 3。「料理の楽しさ」を深める機能。 |
| 11  | ネットスーパー・ミールキット連携          | 買い物リストの食材を提携ネットスーパー等にワンタップで注文できる。                                                                                             | マネタイズ機能。                               |
| 12  | プレミアムプラン                          | 管理栄養士監修の特別プラン、広告非表示などの有料会員機能。                                                                                                     | マ не タイズ機能。                             |

---

## 2\. アカウント登録機能

### 2.1. 機能概要

ユーザーがサービスを利用するために、本人固有のアカウントを作成する機能。登録にはメールアドレスとパスワードを使用する。作成されたアカウントは、Supabase の認証機能(Supabase Auth)によって安全に管理される。

### 2.2. ユーザーゴール

- アプリに自分のパーソナルな空間を確保し、設定情報や利用履歴(料理ログなど)を安全に保存したい。
- 一度登録すれば、どのデバイスからでも自分のデータにアクセスできるようにしたい。

### 2.3. ユースケース

1.  新規ユーザーがアプリを起動する。
2.  表示されたアカウント登録画面で、メールアドレス、パスワード、パスワード(確認用)を入力する。
3.  「登録する」ボタンをタップする。
4.  システムは入力内容を検証する。
5.  検証に成功した場合、システムは Supabase Auth にユーザー情報を新規作成し、ユーザーをログイン状態にする。
6.  ユーザーはプロファイル設定の最初のステップにリダイレクトされる。

### 2.4. 機能要件

| ID   | 要件名                 | 詳細                                                                                                                 |
| :--- | :--------------------- | :------------------------------------------------------------------------------------------------------------------- |
| R-01 | メールアドレス形式検証 | 入力されたメールアドレスが、一般的な形式 (`name@domain.com`)に準拠していることを検証する。                           |
| R-02 | メールアドレス重複検証 | 入力されたメールアドレスが、既にシステムに登録済みでないかを検証する。重複している場合はエラーメッセージを表示する。 |
| R-03 | パスワード文字数検証   | 入力されたパスワードが、最低 8 文字以上であることを検証する。                                                        |
| R-04 | パスワード一致検証     | 「パスワード」と「パスワード(確認用)」の 2 つのフィールドに入力された値が完全に一致していることを検証する。          |
| R-05 | エラーメッセージ表示   | 上記のいずれかの検証でエラーが発生した場合、ユーザーに分かりやすいエラーメッセージを表示する。                       |
| R-06 | ユーザー作成処理       | すべての検証をクリアした場合、入力されたメールアドレスとパスワードで Supabase Auth に新しいユーザーを作成する。      |
| R-07 | 自動ログインと画面遷移 | ユーザー作成に成功した場合、ユーザーを自動的にログイン状態にし、次のプロファイル設定画面へ遷移させる。               |

### 2.5. 非機能要件

| ID    | 要件名                   | 詳細                                                                                                  |
| :---- | :----------------------- | :---------------------------------------------------------------------------------------------------- |
| NF-01 | セキュリティ(パスワード) | パスワードはハッシュ化してデータベースに保存され、平文のまま保存されないこと。(Supabase が自動で対応) |
| NF-02 | セキュリティ(通信)       | アプリとサーバー間のすべての通信は、SSL/TLS によって暗号化されること。(Supabase が自動で対応)         |

### 2.6. UI/画面項目

- **タイトル**: 「アカウント登録」
- **入力フィールド**:
  - メールアドレス
  - パスワード (入力中は文字を隠す)
  - パスワード(確認用) (入力中は文字を隠す)
- **ボタン**:
  - 登録ボタン
- **リンク**:
  - 利用規約へのリンク
  - プライバシーポリシーへのリンク
  - 既存ユーザー向けのログイン画面へのリンク

---

## 3\. プロファイル設定機能

### 3.1. 目的

- ユーザー登録後、最初の数分でパーソナライズの精度を最大化するための基本情報を取得する。
- 質問形式にすることで、面倒な入力を「対話」のように感じさせ、設定完了へのモチベーションを維持する。

### 3.2. UI/UX の基本方針

- 1 画面に 1 つの質問を基本とし、ユーザーが集中できるようにする。
- 選択肢は直感的にタップできるボタン形式で提示する。
- いつでも「スキップ」や「後で設定」が可能とし、ユーザーにストレスを与えない。

### 3.3. 初期設定時の質問事項リスト

#### Step 1: あなたについて教えてください

- **質問 1: なんてお呼びすればいいですか？**
  - **入力形式**: テキスト入力
  - **意図**: アプリからの呼びかけをパーソナライズし、親近感を持ってもらうため。
- **質問 2: 普段、何人で食事をしますか？**
  - **入力形式**: 選択式 + 数値入力 ([ひとり] or [複数人] → 大人[ ]人 子ども[ ]人)
  - **意図**: 提案するレシピの分量を計算する際の最も重要な基礎情報。

#### Step 2: 食事の好みやこだわりを教えてください

- **質問 3: アレルギーのある食材はありますか？**
  - **入力形式**: 複数選択式 + 自由入力 (主要アレルゲンボタン + その他自由入力欄)
  - **意図**: 安全に関わる最重要項目。該当食材を献立から確実に除外するため。
- **質問 4: 苦手で食べられないものはありますか？**
  - **入力形式**: 自由入力
  - **意図**: ユーザーが嫌いなものを提案してしまい、アプリへの満足度が下がるのを防ぐため。
- **質問 5: 食生活で特に意識していることは何ですか？ (複数選択可)**
  - **入力形式**: 複数選択式 ([栄養バランス・健康], [節約], [時短・手軽さ], [ダイエット], [筋力アップ], [特にない])
  - **意図**: 「三ツ星スコア」の評価や献立提案の方向性を決定する重要な情報。ユーザーの価値観を理解する。

#### Step 3: 料理のスタイルを教えてください

- **質問 6: あなたの料理スキルはどれくらいですか？**
  - **入力形式**: 選択式 ([ほぼ初めて], [レシピを見れば作れる], [アレンジも楽しみたい])
  - **意図**: 提案するレシピの難易度を調整するため。
- **質問 7: 毎日の食事づくり、あなたのスタイルはどれですか？**
  - **入力形式**: 選択式 ([じっくり手作りを楽しむ], [手料理を楽しみつつも、お惣菜や冷凍食品も使う], etc.)
  - **意図**: 「柔軟なハイブリッド献立」機能の提案バランスを調整するため。ユーザーの現実的なライフスタイルに寄り添う。

### 3.4. 要件まとめ

- **必須/任意項目**: アレルギー情報など重要項目以外はスキップ可能にする。
- **後からの編集**: 初期設定内容は、すべて後から「設定画面」で変更・修正できる。
- **データ保持**: プロファイル情報は、Supabase の`profiles`テーブルに安全に保存される。
- **UI デザイン**: 各質問が 1 画面に収まり、サクサク進められるテンポの良い UI を提供する。

---

## 4\. “今週まるごと”おまかせ献立提案機能

### 4.1. 機能概要

ユーザーのプロファイルに基づき、AI が栄養バランスと多様性を考慮した 1 週間分の献立を自動提案する。市販品も活用した現実的な献立を提案し、ユーザーは自由に調整・確定できる。確定後に買い物リストを自動生成する。

### 4.2. ユーザーゴール

- 「今日の晩ごはん、何にしよう...」と毎日考えるストレスから解放されたい。
- 提案を見て「これなら作れそう」と、料理へのモチベーションを高めたい。
- 忙しい日でも罪悪感なくバランスの取れた食事がしたい。
- 計画的な献立によって、時間と食費の無駄をなくしたい。

### 4.3. UI/UX のコアコンセプト

- **「下書き → 確定」ワークフロー**: AI の初回提案は「下書き」。ユーザーが自由に変更し、「確定」ボタンを押すと初めて買い物リストが生成される。
- **視覚的で楽しい献立表示**: 文字のリストではなく、雑誌のようなイメージ画像中心のビューで表示する。
- **対話的な献立調整**: 気に入らない日の献立は、ボタン一つで気軽に変更できる対話的な体験を提供する。
- **現実的なライフスタイルへの寄り添い**: 市販品を「賢い時短術」として積極的に提案に組み込み、罪悪感をなくす。

### 4.4. 機能要件

| カテゴリ                 | ID   | 要件名               | 詳細                                                                                                                |
| :----------------------- | :--- | :------------------- | :------------------------------------------------------------------------------------------------------------------ |
| **提案ロジック**         | R-10 | プロファイル連携     | 登録済みのプロファイル情報(家族構成, アレルギー, 健康志向, 料理スタイル)を必ず反映する。                            |
|                          | R-11 | 栄養・食材の多様性   | 7 日間の献立で、栄養バランスが偏らず、主菜の食材(肉, 魚, 大豆製品など)が多様になるように考慮する。                  |
|                          | R-12 | ハイブリッド献立提案 | プロファイルの「料理のスタイル」に基づき、市販品と手料理を組み合わせた献立を提案する。                              |
| **表示**                 | R-20 | 週間カレンダー表示   | 提案された献立は、1 週間を見渡せるカレンダー形式で表示する。                                                        |
|                          | R-21 | 魅力的なカード UI    | 各日の献立はイメージ画像、料理名、三ツ星スコアの要約、「お惣菜活用」などのタグを表示する。                          |
|                          | R-22 | 状態表示             | 献立が「下書き」状態か「確定」状態かが明確に分かるように表示する。                                                  |
| **編集・フィードバック** | R-30 | 日単位での再提案     | 特定の日付を選択し、その日の献立だけを再提案させることができる。                                                    |
|                          | R-31 | 再提案時の意図反映   | 再提案時、ユーザーは簡単な意図(「手軽さ」「ジャンル変更」など)を伝えることができ、AI はその意図を反映する。         |
|                          | R-32 | 手動での料理変更     | (発展機能)ユーザーが特定の料理を検索し、手動で献立を入れ替えることができる。                                        |
| **確定・買い物リスト**   | R-40 | 献立の確定           | ユーザーが「確定」アクションを行うまで、週間買い物リストは生成されない。                                            |
|                          | R-41 | 週間買い物リスト生成 | 確定された 7 日間の手作り料理に必要な食材と分量を合算し、重複を除いた買い物リストを自動生成する。(市販品は含めない) |
|                          | R-42 | 日別買い物リスト表示 | (参考情報として)各日の献立カード詳細では、その日ごとに必要な食材リストも確認できる。                                |

### 4.5. 非機能要件

- **パフォーマンス**: 献立提案リクエストから結果表示まで 5 秒以内。ローディングアニメーションを表示する。
- **アピール性**: イメージ画像は、スタイリッシュな線画イラストなどを使用する。

---

## 5\. 「三ツ星スコア」機能

### 5.1. 機能概要

提案された各献立の「栄養バランス」「概算費用」「調理手間」を、それぞれ星 1〜3 つのスコアで直感的に可視化する機能。

### 5.2. ユーザーゴール

- 献立が今日の気分や状況に合っているかを一目で判断したい。
- 献立を再提案してもらう際の判断材料が欲しい。
- ゲームのステータス画面のように、楽しみながら献立を選びたい。

### 5.3. 機能要件

| ID   | 要件名             | 詳細                                                                                                                                                                                                          |
| :--- | :----------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| R-50 | スコア算出ロジック | 各レシピデータに基づき 3 つのスコアを算出。<br>・**栄養**: PFC バランス, 野菜の量などから算出。<br>・**費用**: 食材の単価や旬の度合いから算出。<br>・**手間**: 調理時間, 工程数, 調理器具の多さなどから算出。 |
| R-51 | スコア表示         | 週間献立提案の各曜日の献立カード上に、3 項目それぞれの三ツ星スコアを必ず表示する。                                                                                                                            |
| R-52 | スコア基準の定義   | 星 1〜3 がそれぞれ何を意味するかの基準を定義する。<br>例(手間): ★★★=15 分以内, ★★☆=30 分以内, ★☆☆=30 分以上                                                                                                   |

---

## 6\. “ムダなし”買い物リスト機能

### 6.1. 機能概要

ユーザーが「確定」した 1 週間分の献立から、必要な食材を自動で抽出し、買い物チェックリストを作成する機能。

### 6.2. ユーザーゴール

- 献立から買うものを考える手間をなくしたい。
- スーパーの売り場を効率的に回り、買い物の時間を短縮したい。
- 買い忘れを防ぎたい。

### 6.3. UI/UX のコアコンセプト

- **完全自動生成**: ユーザーが献立を「確定」すると、自動でリストが作成される。
- **インタラクティブなチェックリスト**: 買い物中にタップするだけで購入済みかが一目でわかる。
- **賢いカテゴリ分類**: 食材を売り場ごとに分類し、スーパーでの思考時間をゼロにする。

### 6.4. 機能要件

| カテゴリ       | ID   | 要件名                 | 詳細                                                                                                           |
| :------------- | :--- | :--------------------- | :------------------------------------------------------------------------------------------------------------- |
| **リスト生成** | R-60 | 確定トリガー           | 買い物リストの生成は、ユーザーが献立を「確定」したタイミングで自動的に実行される。                             |
|                | R-61 | 食材の自動集計         | 確定した 7 日間の全献立から、必要な食材名と総量を自動で集計する。(例: 玉ねぎ 1 個 + 2 個 → 玉ねぎ: 3 個)       |
| **表示と操作** | R-70 | カテゴリ別表示         | 食材は「野菜」「肉」「魚」のように、売り場を意識したカテゴリに自動で分類して表示する。                         |
|                | R-71 | チェックリスト機能     | 各アイテムはチェックボックス付きで表示し、タップすると購入済みであることが視覚的に分かるように状態が変化する。 |
|                | R-72 | 購入済みアイテムの移動 | チェックされたアイテムは、リストの最下部にある「購入済み」セクションに自動で移動する。                         |

---

## 7\. 「作った料理の記録(料理ログ)」機能

### 7.1. 機能概要

ユーザーが調理した献立を、写真やメモと共に記録する機能。記録はカレンダー形式で可視化され、食生活を楽しく振り返ることができる。

### 7.2. ユーザーゴール

- 日々の頑張りを実感し、達成感を得たい。
- 過去に何を作ったか簡単に思い出したい。
- 料理の習慣化のモチベーションにしたい。

### 7.3. UI/UX のコアコンセプト

- **低コストな記録体験**: 料理名は自動入力。ユーザーは写真を撮ってメモするだけで完了する手軽さを目指す。
- **視覚的な達成感**: カレンダーに自分の料理写真が埋まっていく「塗り絵」のような楽しさを提供する。
- **ポジティブなフィードバック**: 記録直後に「今日の料理も素敵ですね！」のようなメッセージを表示し、ユーザーの行動を称賛する。

### 7.4. 機能要件

| カテゴリ       | ID    | 要件名             | 詳細                                                                                         |
| :------------- | :---- | :----------------- | :------------------------------------------------------------------------------------------- |
| **記録機能**   | R-90  | ログ作成機能       | ユーザーが調理した料理の記録を作成できる。                                                   |
|                | R-91  | 献立情報の自動入力 | ログ作成時、その日に計画されていた献立の料理名が自動で入力されている。                       |
|                | R-92  | ログの構成要素     | ログは「日付」「紐づく献立」「写真(1 枚)」「自由記述のメモ欄」で構成される。                 |
|                | R-93  | 写真アップロード   | スマートフォンのカメラ起動、またはフォトライブラリから選択して写真をアップロードできる。     |
|                | R-94  | ログの保存         | 作成されたログは、ユーザーアカウントに紐づけて Supabase に保存される。                       |
| **表示機能**   | R-100 | カレンダービュー   | 記録したログを一覧できる、月表示のカレンダー画面がある。                                     |
|                | R-101 | ログの可視化       | ログが記録されている日付には、アップロードした写真のサムネイルがカレンダー上に表示される。   |
|                | R-102 | ログ詳細表示       | カレンダーの日付をタップすると、その日に記録したログの詳細(写真, メモ, 献立名)が表示される。 |
| **編集・削除** | R-110 | ログの編集         | 過去に記録したログの写真やメモを後から編集できる。                                           |
|                | R-111 | ログの削除         | 過去に記録したログを削除できる。                                                             |

### 7.5. 非機能要件

- **画像の最適化**: アップロードされた写真は、表示速度に影響を与えないよう、適切なサイズに自動で圧縮・リサイズしてから保存する。
- **パフォーマンス**: カレンダー画面は、1 ヶ月分の写真サムネイルが読み込まれても、スムーズにスクロールできる。

---

## 8\. TOP ページ（ホーム画面）の UI 提案

### 8.1. コンセプト

ユーザーの状態（献立が確定済みか、未確定か）に応じて、やるべきことを一つだけ提示する。

### 8.2. パターン A: 献立が「未確定」の場合

- **目的**: アプリのコア機能である「週間献立提案」へと、ユーザーをまっすぐに導く。
- **画面構成**:
  - **メインアクションボタン**: 画面中央に「今週の献立プランを作成する」ボタンを一つだけ配置。
  - **サイドメニュー**: 左上にハンバーガーメニューアイコンを配置。
  - **ボトムタブバー**: 主要機能（ホーム, 買い物リスト, カレンダー）へのショートカットを配置。

### 8.3. パターン B: 献立が「確定済み」の場合

- **目的**: 「今日」と「今週全体」の献立をすぐに確認できるようにする。
- **画面構成**:
  - **今日の献立**: 最も重要な情報である「今日の献立」を画面上部に分かりやすく表示。
  - **週間献立サマリー**: 今週全体の献立の概要をリスト形式で表示。
  - **詳細へのリンク**: 「献立プラン全体を見る」をタップすると、週間献立画面へ遷移。
  - **サイドメニュー**と**ボトムタブバー**はパターン A と共通。

### 8.4. サイドメニューの内容

- **役割**: 毎日使うわけではないが、必要な時にアクセスしたい項目（各種設定や利用規約など）をすっきりとまとめる。
- **項目**:
  - [ニックネーム]さん
  - プロフィール設定
  - アカウント設定
  - 使い方ガイド
  - 利用規約
  - プライバシーポリシー
  - ログアウト

### 提案する技術スタック

| 領域                       | 技術・サービス              | 役割と選定理由                                                                                                                                                                                                                                                                                                                                             |
| :------------------------- | :-------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **フロントエンド**         | **React Native + Expo**     | **（確定事項）** クロスプラットフォーム開発が可能で、開発体験が非常に良い。                                                                                                                                                                                                                                                                                |
| **バックエンド (BaaS)**    | **Supabase**                | 認証、データベース、ストレージといったバックエンドの基本機能を一気通貫で提供。要件定義書との親和性が極めて高い。                                                                                                                                                                                                                                           |
| ├ **認証**                 | Supabase Auth               | [cite_start]メールアドレス・パスワード認証を安全かつ容易に実装できる [cite: 7]。                                                                                                                                                                                                                                                                           |
| ├ **データベース**         | Supabase (PostgreSQL)       | [cite_start]ユーザープロファイル [cite: 139][cite_start]、料理ログ [cite: 340] などのデータ保存先。信頼性と拡張性の高い PostgreSQL がベース。                                                                                                                                                                                                              |
| ├ **ストレージ**           | Supabase Storage            | [cite_start]料理ログでアップロードされる写真の保存先として最適 [cite: 349]。画像の最適化（リサイズなど）も関数と組み合わせて実現可能。                                                                                                                                                                                                                     |
| **サーバーサイドロジック** | **Supabase Edge Functions** | 献立提案 AI ロジックの実行環境。クライアントから直接 AI API を叩くのではなく、このサーバーレス関数を経由させることで、セキュリティを担保し、複雑な処理を実行できる。TypeScript で開発可能。                                                                                                                                                                |
| **AI（献立提案エンジン）** | **OpenAI API (GPT-4 など)** | [cite_start]アプリのコア機能である「おまかせ献立提案」の頭脳部分 [cite: 141][cite_start]。ユーザーのプロファイル情報（アレルギー、好み、スキルなど） [cite: 172] [cite_start]をプロンプトとして渡し、栄養バランスや多様性を考慮した献立 [cite: 173][cite_start]、さらには「お惣菜活用」といったハイブリッドな提案 [cite: 178] を生成させるのに非常に強力。 |
